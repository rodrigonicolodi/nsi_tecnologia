<% layout = 'layout' %>
<% titulo = 'Editar Ordem de Serviço' %>

<div class="container">
  <h2>Editar Ordem de Serviço</h2>

  <% if (erro) { %>
    <p class="erro"><%= erro %></p>
  <% } %>

  <form action="/os/atualizar/<%= os.id %>" method="POST" class="form-coluna">
    <div class="campo">
      <label for="solicitante_id">Solicitante</label>
      <select id="solicitante_id" name="solicitante_id" required>
        <% (pessoas || []).forEach(p => { %>
          <option value="<%= p.id %>" <%= os.solicitante_id == p.id ? 'selected' : '' %>><%= p.nome %></option>
        <% }) %>
      </select>
    </div>

    <div class="campo">
      <label for="responsavel_id">Responsável Técnico</label>
      <select id="responsavel_id" name="responsavel_id" required>
        <% (tecnicos || []).forEach(t => { %>
          <option value="<%= t.id %>" <%= os.responsavel_id == t.id ? 'selected' : '' %>><%= t.nome %></option>
        <% }) %>
      </select>
    </div>

    <div class="campo">
      <label for="tipo_servico">Tipo de Serviço</label>
      <input type="text" id="tipo_servico" name="tipo_servico" value="<%= os.tipo_servico %>" required>
    </div>

    <div class="campo">
      <label for="prioridade">Prioridade</label>
      <select id="prioridade" name="prioridade">
        <option value="baixa" <%= os.prioridade === 'baixa' ? 'selected' : '' %>>Baixa</option>
        <option value="media" <%= os.prioridade === 'media' ? 'selected' : '' %>>Média</option>
        <option value="alta" <%= os.prioridade === 'alta' ? 'selected' : '' %>>Alta</option>
        <option value="critica" <%= os.prioridade === 'critica' ? 'selected' : '' %>>Crítica</option>
      </select>
    </div>

    <div class="campo" style="grid-column: 1 / -1;">
      <label for="problema_informado">Problema Informado <small>(opcional)</small></label>
      <textarea id="problema_informado" name="problema_informado" rows="3" placeholder="Descreva o problema relatado pelo cliente"><%= os.problema_informado %></textarea>
    </div>

    <div class="campo">
      <label for="valor_servico">Valor do Serviço <small>(opcional)</small></label>
      <input type="number" step="0.01" id="valor_servico" name="valor_servico" value="<%= os.valor_servico %>" placeholder="0.00">
    </div>

    <div class="campo">
      <label for="desconto">Desconto <small>(opcional)</small></label>
      <input type="number" step="0.01" id="desconto" name="desconto" value="<%= os.desconto %>" placeholder="0.00">
    </div>

    <div class="campo">
      <label for="acrescimos">Valor de Produto <small>(opcional)</small></label>
      <input type="number" step="0.01" id="acrescimos" name="acrescimos" value="<%= os.acrescimos %>" placeholder="0.00">
    </div>

    <div class="campo" style="grid-column: 1 / -1; text-align: center;">
      <button type="submit" class="btn btn-azul">
        <i class="fas fa-save"></i> Atualizar OS
      </button>
    </div>
  </form>
</div>