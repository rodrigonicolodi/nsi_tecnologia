<% layout = 'layout' %>
<% titulo = 'Editar Pessoa' %>

<div class="container">
  <h2>Editar Pessoa</h2>

  <% if (erro) { %>
    <p class="erro"><%= erro %></p>
  <% } %>
  <% if (sucesso) { %>
    <p class="sucesso"><%= sucesso %></p>
  <% } %>

  <form method="POST" action="/pessoas/editar/<%= pessoa.id %>" class="form-coluna">
    <div class="campo">
      <label for="tipo"><strong>Tipo:</strong></label>
      <select name="tipo" id="tipo">
        <option value="cliente" <%= pessoa.tipo === 'cliente' ? 'selected' : '' %>>Cliente</option>
        <option value="tecnico" <%= pessoa.tipo === 'tecnico' ? 'selected' : '' %>>TÃ©cnico</option>
        <option value="fornecedor" <%= pessoa.tipo === 'fornecedor' ? 'selected' : '' %>>Fornecedor</option>
        <option value="interno" <%= pessoa.tipo === 'interno' ? 'selected' : '' %>>Interno</option>
      </select>
    </div>

    <div class="campo">
      <label for="nome"><strong>Nome:</strong></label>
      <input type="text" name="nome" id="nome" value="<%= pessoa.nome %>">
    </div>

    <div class="campo">
      <label><strong>RazÃ£o Social:</strong></label>
      <input type="text" name="razao_social" value="<%= pessoa.razao_social %>">
    </div>

    <div class="campo">
      <label><strong>Nome Fantasia:</strong></label>
      <input type="text" name="nome_fantasia" value="<%= pessoa.nome_fantasia %>">
    </div>

    <div class="campo">
      <label><strong>CPF / CNPJ:</strong></label>
      <input type="text" name="documento" id="documento" value="<%= pessoa.documento %>" placeholder="000.000.000-00 ou 00.000.000/0000-00">
    </div>

    <div class="campo">
      <label><strong>RG / IE:</strong></label>
      <input type="text" name="rg_ie" id="rg_ie" value="<%= pessoa.rg_ie %>" placeholder="00.000.000-0">
    </div>

    <div class="campo">
      <label><strong>Data de Nascimento:</strong></label>
      <input type="date" name="data_nascimento" value="<%= pessoa.data_nascimento %>">
    </div>

    <div class="campo">
      <label><strong>Sexo:</strong></label>
      <select name="sexo">
        <option value="masculino" <%= pessoa.sexo === 'masculino' ? 'selected' : '' %>>Masculino</option>
        <option value="feminino" <%= pessoa.sexo === 'feminino' ? 'selected' : '' %>>Feminino</option>
        <option value="outro" <%= pessoa.sexo === 'outro' ? 'selected' : '' %>>Outro</option>
      </select>
    </div>

    <div class="campo">
      <label><strong>Estado Civil:</strong></label>
      <input type="text" name="estado_civil" value="<%= pessoa.estado_civil %>">
    </div>

    <div class="campo">
      <label><strong>ProfissÃ£o:</strong></label>
      <input type="text" name="profissao" value="<%= pessoa.profissao %>">
    </div>

    <div class="campo">
      <label><strong>Email:</strong></label>
      <input type="email" name="email" value="<%= pessoa.email %>">
    </div>

    <div class="campo">
      <label><strong>CÃ³digo do PaÃ­s:</strong></label>
      <select name="codigo_pais">
        <option value="+55" <%= pessoa.codigo_pais === '+55' ? 'selected' : '' %>>ğŸ‡§ğŸ‡· Brasil (+55)</option>
        <option value="+1" <%= pessoa.codigo_pais === '+1' ? 'selected' : '' %>>ğŸ‡ºğŸ‡¸ Estados Unidos (+1)</option>
        <option value="+54" <%= pessoa.codigo_pais === '+54' ? 'selected' : '' %>>ğŸ‡¦ğŸ‡· Argentina (+54)</option>
        <option value="+56" <%= pessoa.codigo_pais === '+56' ? 'selected' : '' %>>ğŸ‡¨ğŸ‡± Chile (+56)</option>
        <option value="+57" <%= pessoa.codigo_pais === '+57' ? 'selected' : '' %>>ğŸ‡¨ğŸ‡´ ColÃ´mbia (+57)</option>
        <option value="+598" <%= pessoa.codigo_pais === '+598' ? 'selected' : '' %>>ğŸ‡ºğŸ‡¾ Uruguai (+598)</option>
        <option value="+595" <%= pessoa.codigo_pais === '+595' ? 'selected' : '' %>>ğŸ‡µğŸ‡¾ Paraguai (+595)</option>
        <option value="+51" <%= pessoa.codigo_pais === '+51' ? 'selected' : '' %>>ğŸ‡µğŸ‡ª Peru (+51)</option>
        <option value="+591" <%= pessoa.codigo_pais === '+591' ? 'selected' : '' %>>ğŸ‡§ğŸ‡´ BolÃ­via (+591)</option>
        <option value="+58" <%= pessoa.codigo_pais === '+58' ? 'selected' : '' %>>ğŸ‡»ğŸ‡ª Venezuela (+58)</option>
        <option value="+351" <%= pessoa.codigo_pais === '+351' ? 'selected' : '' %>>ğŸ‡µğŸ‡¹ Portugal (+351)</option>
        <option value="+34" <%= pessoa.codigo_pais === '+34' ? 'selected' : '' %>>ğŸ‡ªğŸ‡¸ Espanha (+34)</option>
        <option value="+39" <%= pessoa.codigo_pais === '+39' ? 'selected' : '' %>>ğŸ‡®ğŸ‡¹ ItÃ¡lia (+39)</option>
        <option value="+33" <%= pessoa.codigo_pais === '+33' ? 'selected' : '' %>>ğŸ‡«ğŸ‡· FranÃ§a (+33)</option>
        <option value="+49" <%= pessoa.codigo_pais === '+49' ? 'selected' : '' %>>ğŸ‡©ğŸ‡ª Alemanha (+49)</option>
        <option value="+44" <%= pessoa.codigo_pais === '+44' ? 'selected' : '' %>>ğŸ‡¬ğŸ‡§ Reino Unido (+44)</option>
      </select>
    </div>

    <div class="campo">
      <label><strong>Telefone/Celular:</strong></label>
      <input type="text" name="telefone" id="telefone" value="<%= pessoa.telefone || pessoa.celular || pessoa.whatsapp %>" placeholder="(11) 99999-9999">
    </div>

    <div class="campo">
      <label><strong>CEP:</strong></label>
      <input type="text" name="cep" id="cep" value="<%= pessoa.cep %>" placeholder="00000-000">
    </div>

    <div class="campo">
      <label><strong>EndereÃ§o:</strong></label>
      <input type="text" name="endereco" value="<%= pessoa.endereco %>">
    </div>

    <div class="campo">
      <label><strong>NÃºmero:</strong></label>
      <input type="text" name="numero" value="<%= pessoa.numero %>">
    </div>

    <div class="campo">
      <label><strong>Complemento:</strong></label>
      <input type="text" name="complemento" value="<%= pessoa.complemento %>">
    </div>

    <div class="campo">
      <label><strong>Bairro:</strong></label>
      <input type="text" name="bairro" value="<%= pessoa.bairro %>">
    </div>

    <div class="campo">
      <label><strong>Cidade:</strong></label>
      <input type="text" name="cidade" value="<%= pessoa.cidade %>">
    </div>

    <div class="campo">
      <label><strong>UF:</strong></label>
      <input type="text" name="uf" maxlength="2" value="<%= pessoa.uf %>">
    </div>

    <div class="campo">
      <label><strong>PaÃ­s:</strong></label>
      <input type="text" name="pais" value="<%= pessoa.pais %>">
    </div>

    <div class="campo">
      <label><strong>Contato ResponsÃ¡vel:</strong></label>
      <input type="text" name="contato_responsavel" value="<%= pessoa.contato_responsavel %>">
    </div>

    <div class="campo" style="grid-column: span 2;">
      <label><strong>ObservaÃ§Ãµes:</strong></label>
      <textarea name="observacoes"><%= pessoa.observacoes %></textarea>
    </div>

    <div class="campo">
      <label><strong>Status:</strong></label>
      <select name="status">
        <option value="ativo" <%= pessoa.status === 'ativo' ? 'selected' : '' %>>Ativo</option>
        <option value="inativo" <%= pessoa.status === 'inativo' ? 'selected' : '' %>>Inativo</option>
      </select>
    </div>

    <div class="campo" style="grid-column: span 2; text-align: center;">
      <button type="submit" class="btn-azul">
        <i class="fas fa-save"></i> Salvar AlteraÃ§Ãµes
      </button>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // MÃ¡scara para CPF/CNPJ
  const documentoInput = document.getElementById('documento');
  if (documentoInput) {
    documentoInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length <= 11) {
        // CPF: 000.000.000-00
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      } else {
        // CNPJ: 00.000.000/0000-00
        value = value.replace(/(\d{2})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1/$2');
        value = value.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
      }
      e.target.value = value;
    });
  }

  // MÃ¡scara para RG
  const rgInput = document.getElementById('rg_ie');
  if (rgInput) {
    rgInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      value = value.replace(/(\d{2})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d)/, '$1.$2');
      value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      e.target.value = value;
    });
  }

  // MÃ¡scara para telefone
  const telefoneInput = document.getElementById('telefone');
  if (telefoneInput) {
    telefoneInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length <= 10) {
        // Telefone fixo: (11) 3333-4444
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
      } else {
        // Celular: (11) 99999-9999
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
      }
      e.target.value = value;
    });
  }

  // MÃ¡scara para CEP
  const cepInput = document.getElementById('cep');
  if (cepInput) {
    cepInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      value = value.replace(/(\d{5})(\d)/, '$1-$2');
      e.target.value = value;
    });
  }
});
</script>