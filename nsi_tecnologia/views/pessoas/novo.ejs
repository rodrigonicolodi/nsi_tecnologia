<% layout = 'layout' %>
<% titulo = 'Nova Pessoa' %>

<div class="container">
  <h2>Cadastro de Pessoa</h2>

  <% if (erro) { %>
    <p class="erro"><%= erro %></p>
  <% } %>
  <% if (sucesso) { %>
    <p class="sucesso"><%= sucesso %></p>
  <% } %>

  <form method="POST" action="/pessoas/novo" class="form-coluna">
    <div class="campo">
      <label>Tipo:</label>
      <select name="tipo">
        <option value="cliente">Cliente</option>
        <option value="tecnico">Técnico</option>
        <option value="fornecedor">Fornecedor</option>
        <option value="interno">Interno</option>
      </select>
    </div>

    <div class="campo">
      <label>Nome:</label>
      <input type="text" name="nome" id="nome">
    </div>

    <div class="campo">
      <label>Razão Social:</label>
      <input type="text" name="razao_social">
    </div>

    <div class="campo">
      <label>Nome Fantasia:</label>
      <input type="text" name="nome_fantasia">
    </div>

    <div class="campo">
      <label>CPF / CNPJ:</label>
      <input type="text" name="documento" id="documento" placeholder="000.000.000-00 ou 00.000.000/0000-00">
    </div>

    <div class="campo">
      <label>RG / IE:</label>
      <input type="text" name="rg_ie" id="rg_ie" placeholder="00.000.000-0">
    </div>

    <div class="campo">
      <label>Data de Nascimento:</label>
      <input type="date" name="data_nascimento">
    </div>

    <div class="campo">
      <label>Sexo:</label>
      <select name="sexo">
        <option value="masculino">Masculino</option>
        <option value="feminino">Feminino</option>
        <option value="outro">Outro</option>
      </select>
    </div>

    <div class="campo">
      <label>Estado Civil:</label>
      <input type="text" name="estado_civil">
    </div>

    <div class="campo">
      <label>Profissão:</label>
      <input type="text" name="profissao">
    </div>

    <div class="campo">
      <label>Email:</label>
      <input type="email" name="email">
    </div>

    <div class="campo">
      <label>Telefone/Celular:</label>
      <input type="text" name="telefone" id="telefone" placeholder="(11) 99999-9999">
    </div>

    <div class="campo">
      <label>CEP:</label>
      <input type="text" name="cep" id="cep" placeholder="00000-000">
    </div>

    <div class="campo">
      <label>Endereço:</label>
      <input type="text" name="endereco">
    </div>

    <div class="campo">
      <label>Número:</label>
      <input type="text" name="numero">
    </div>

    <div class="campo">
      <label>Complemento:</label>
      <input type="text" name="complemento">
    </div>

    <div class="campo">
      <label>Bairro:</label>
      <input type="text" name="bairro">
    </div>

    <div class="campo">
      <label>Cidade:</label>
      <input type="text" name="cidade">
    </div>

    <div class="campo">
      <label>UF:</label>
      <input type="text" name="uf" maxlength="2">
    </div>

    <div class="campo">
      <label>País:</label>
      <input type="text" name="pais" value="Brasil">
    </div>

    <div class="campo">
      <label>Contato Responsável:</label>
      <input type="text" name="contato_responsavel">
    </div>

    <div class="campo" style="grid-column: span 2;">
      <label>Observações:</label>
      <textarea name="observacoes"></textarea>
    </div>

    <div class="campo">
      <label>Status:</label>
      <select name="status">
        <option value="ativo">Ativo</option>
        <option value="inativo">Inativo</option>
      </select>
    </div>

    <div class="campo">
      <button type="submit" class="btn btn-azul" id="btn-salvar-pessoa">
        <i class="fas fa-save"></i> Salvar Pessoa
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    const botao = document.getElementById('btn-salvar-pessoa');

    form.addEventListener('submit', function () {
      botao.disabled = true;
      botao.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
    });

    // Máscara para CPF/CNPJ
    const documentoInput = document.getElementById('documento');
    if (documentoInput) {
      documentoInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 11) {
          // CPF: 000.000.000-00
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        } else {
          // CNPJ: 00.000.000/0000-00
          value = value.replace(/(\d{2})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d)/, '$1.$2');
          value = value.replace(/(\d{3})(\d)/, '$1/$2');
          value = value.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
        }
        e.target.value = value;
      });
    }

    // Máscara para RG
    const rgInput = document.getElementById('rg_ie');
    if (rgInput) {
      rgInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{2})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
      });
    }

    // Máscara para telefone
    const telefoneInput = document.getElementById('telefone');
    if (telefoneInput) {
      telefoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 10) {
          // Telefone fixo: (11) 3333-4444
          value = value.replace(/(\d{2})(\d)/, '($1) $2');
          value = value.replace(/(\d{4})(\d)/, '$1-$2');
        } else {
          // Celular: (11) 99999-9999
          value = value.replace(/(\d{2})(\d)/, '($1) $2');
          value = value.replace(/(\d{5})(\d)/, '$1-$2');
        }
        e.target.value = value;
      });
    }

    // Máscara para CEP
    const cepInput = document.getElementById('cep');
    if (cepInput) {
      cepInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
      });
    }
  });
</script>