<% layout = 'layout' %>
<% titulo = 'Editar Lançamento Financeiro' %>

<div class="container">
  <h2><%= titulo %></h2>

  <% if (erro) { %>
    <p class="erro"><%= erro %></p>
  <% } %>
  <% if (sucesso) { %>
    <p class="sucesso"><%= sucesso %></p>
  <% } %>

  <form method="POST" action="/financeiro/editar/<%= lancamento.id %>" class="form-grid">
    <div class="campo">
      <label>Tipo:</label>
      <select name="tipo" required>
        <option value="receber" <%= lancamento.tipo === 'receber' ? 'selected' : '' %>>Receber</option>
        <option value="pagar" <%= lancamento.tipo === 'pagar' ? 'selected' : '' %>>Pagar</option>
      </select>
    </div>

    <div class="campo">
      <label>Pessoa:</label>
      <select name="pessoa_id" required>
        <% pessoas.forEach(p => { %>
          <option value="<%= p.id %>" <%= lancamento.pessoa_id === p.id ? 'selected' : '' %>><%= p.nome %></option>
        <% }) %>
      </select>
    </div>

    <div class="campo">
      <label>Caixa:</label>
      <select name="caixa_id" required>
        <% caixas.forEach(c => { %>
          <option value="<%= c.id %>" <%= lancamento.caixa_id === c.id ? 'selected' : '' %>><%= c.nome %></option>
        <% }) %>
      </select>
    </div>

    <div class="campo">
      <label>Valor:</label>
      <input type="number" step="0.01" name="valor" value="<%= lancamento.valor %>" required>
    </div>

    <div class="campo">
      <label>Vencimento:</label>
      <input type="date" name="vencimento" value="<%= lancamento.vencimento.toISOString().split('T')[0] %>" required>
    </div>

    <div class="campo">
      <label>Status:</label>
      <select name="status">
        <option value="pendente" <%= lancamento.status === 'pendente' ? 'selected' : '' %>>Pendente</option>
        <option value="pago" <%= lancamento.status === 'pago' ? 'selected' : '' %>>Pago</option>
        <option value="cancelado" <%= lancamento.status === 'cancelado' ? 'selected' : '' %>>Cancelado</option>
      </select>
    </div>

    <div class="campo" style="grid-column: span 2;">
      <label>Descrição:</label>
      <textarea name="descricao"><%= lancamento.descricao %></textarea>
    </div>

    <div class="campo">
      <button type="submit" class="btn btn-azul" id="btn-salvar-edicao">
        <i class="fas fa-save"></i> Salvar Alterações
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    const botao = document.getElementById('btn-salvar-edicao');

    form.addEventListener('submit', function () {
      botao.disabled = true;
      botao.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
    });
  });
</script>