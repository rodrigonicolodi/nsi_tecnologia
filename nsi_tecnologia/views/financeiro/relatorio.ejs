<% layout = 'layout' %>
<% titulo = 'Relat√≥rio Financeiro por Per√≠odo' %>

<div class="container">
  <h2><%= titulo %></h2>

  <!-- Filtros -->
  <form method="GET" action="/financeiro/relatorio" class="filtros">
    <div class="campo">
      <label for="inicio">Data In√≠cio:</label>
      <input type="date" name="inicio" id="inicio" value="<%= inicio || '' %>" required>
    </div>

    <div class="campo">
      <label for="fim">Data Fim:</label>
      <input type="date" name="fim" id="fim" value="<%= fim || '' %>" required>
    </div>

    <div class="campo">
      <label for="status">Status:</label>
      <select name="status" id="status">
        <option value="">Todos os status</option>
        <option value="pendente" <%= status === 'pendente' ? 'selected' : '' %>>Pendente</option>
        <option value="pago" <%= status === 'pago' ? 'selected' : '' %>>Pago</option>
        <option value="cancelado" <%= status === 'cancelado' ? 'selected' : '' %>>Cancelado</option>
      </select>
    </div>

    <div class="campo">
      <button type="submit" class="btn btn-azul">
        <i class="fas fa-search"></i> Gerar Relat√≥rio
      </button>
    </div>

    <div class="campo">
      <a href="/pdf/financeiro?inicio=<%= encodeURIComponent(inicio || '') %>&fim=<%= encodeURIComponent(fim || '') %>&status=<%= encodeURIComponent(status || '') %>" class="btn btn-vermelho" target="_blank">
        <i class="fas fa-file-pdf"></i> Exportar PDF
      </a>
    </div>
  </form>

  <% if (lancamentos && lancamentos.length > 0) { %>
    <div class="table-wrapper" style="margin-top: 20px;">
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Tipo</th>
            <th>Pessoa</th>
            <th>Caixa</th>
            <th>Valor</th>
            <th>Parcelas</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% lancamentos.forEach(l => { %>
            <tr>
              <td><%= l.vencimento ? new Date(l.vencimento).toLocaleDateString() : '-' %></td>
              <td><%= l.tipo %></td>
              <td><%= l.pessoa_nome %></td>
              <td><%= l.caixa_origem_nome %></td>
              <td>R$ <%= parseFloat(l.valor).toFixed(2) %></td>
              <td>
                <% if (l.total_parcelas > 1) { %>
                  <span class="parcela-info">
                    <%= l.parcela_atual || 1 %>/<%= l.total_parcelas || 1 %>
                    <% if (l.parcela_pai_id === l.id) { %>
                      <span class="parcela-principal" title="Parcela principal">üëë</span>
                    <% } %>
                  </span>
                <% } else { %>
                  <span class="avista">√Ä Vista</span>
                <% } %>
              </td>
              <td><%= l.status %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <div style="margin-top: 20px;">
      <p><strong>Total a Receber:</strong> R$ <%= totalReceber.toFixed(2) %></p>
      <p><strong>Total a Pagar:</strong> R$ <%= totalPagar.toFixed(2) %></p>
    </div>
  <% } else { %>
    <p style="margin-top: 20px;">Nenhum lan√ßamento encontrado no per√≠odo.</p>
  <% } %>

  <div style="margin-top: 30px;">
    <a href="/financeiro" class="btn btn-azul">
      <i class="fas fa-arrow-left"></i> Voltar para lan√ßamentos
    </a>
  </div>
</div>

<style>
.filtros {
    display: flex;
    gap: 15px;
    align-items: end;
    flex-wrap: wrap;
    margin-bottom: 20px;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
}

.campo {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.campo label {
    font-weight: 600;
    color: #333;
    font-size: 0.9em;
}

.campo input,
.campo select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

/* Estilos espec√≠ficos para filtros */
.filtros .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    text-decoration: none;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.filtros .btn-azul {
    background-color: #0077cc;
    color: white;
}

.filtros .btn-azul:hover {
    background-color: #005fa3;
    color: white;
    text-decoration: none;
}

.filtros .btn-vermelho {
    background-color: #cc3300;
    color: white;
}

.filtros .btn-vermelho:hover {
    background-color: #a62800;
    color: white;
    text-decoration: none;
}
</style>